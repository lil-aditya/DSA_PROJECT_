<!-- <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ADIPE â€” Simulation</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>DSA Project Simulator</h1>
      <form id="simForm">
        <label>Username</label>
        <input name="username" required />
        <label>Priority</label>
        <select name="priority">
          <option>High</option>
          <option>Low</option>
        </select>
        <label>Destination Node</label>
        <input type="number" name="dest" min="0" max="10" value="5" />
        <button type="submit">Run Simulation</button>
      </form>
      <pre id="output"></pre>
    </div>
    <script src="script.js"></script>
  </body>
</html> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADIPE Network Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .log-box {
            height: 400px;
            background-color: #1a1a1a;
            color: #d1d1d1;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse-fast {
            animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-4xl mx-auto p-8">
        <div class="bg-gray-800 shadow-2xl rounded-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-6 text-white">ADIPE Project Simulator</h1>
            
            <!-- System Status -->
            <div class="flex items-center justify-center mb-6">
                <div id="status-light" class="w-4 h-4 rounded-full bg-red-500 mr-3 animate-pulse-fast"></div>
                <span id="status-text" class="font-medium text-red-400">OFFLINE - C++/Python API not detected.</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Left Column: Packet Injection -->
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-white">Inject New Packet</h2>
                    <form id="packet-form" class="space-y-4">
                        <div>
                            <label for="senderID" class="block text-sm font-medium text-gray-300">Sender (User)</label>
                            <select id="senderID" name="senderID" class="mt-1 block w-full bg-gray-700 border-gray-600 text-white rounded-md shadow-sm p-2">
                                <option>Admin</option>
                                <option>UserA</option>
                            </select>
                        </div>
                        <div>
                            <label for="urgency" class="block text-sm font-medium text-gray-300">Priority (Urgency)</label>
                            <select id="urgency" name="urgency" class="mt-1 block w-full bg-gray-700 border-gray-600 text-white rounded-md shadow-sm p-2">
                                <option value="20">High (20)</option>
                                <option value="10">Medium (10)</option>
                                <option value="5">Low (5)</option>
                            </select>
                        </div>
                        <div>
                            <label for="destinationID" class="block text-sm font-medium text-gray-300">Destination Node</label>
                            <input type="number" id="destinationID" name="destinationID" value="5" class="mt-1 block w-full bg-gray-700 border-gray-600 text-white rounded-md shadow-sm p-2">
                        </div>
                        <div>
                            <label for="data" class="block text-sm font-medium text-gray-300">Packet Data</label>
                            <input type="text" id="data" name="data" value="REBOOT_SERVER_COMMAND" class="mt-1 block w-full bg-gray-700 border-gray-600 text-white rounded-md shadow-sm p-2">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                            Inject Packet
                        </button>
                    </form>
                    <div id="inject-status" class="mt-4 text-center"></div>
                </div>

                <!-- Right Column: Live Log -->
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-white">Live C++ Network Log</h2>
                    <div id="log-container" class="log-box w-full p-4 rounded-md overflow-y-auto">
                        Waiting for connection...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- API Endpoints ---
        const PYTHON_API_BASE = "http://127.0.0.1:8000";
        const INJECT_URL = `${PYTHON_API_BASE}/inject`;
        const LOG_URL = `${PYTHON_API_BASE}/log`;
        const STATUS_URL = `${PYTHON_API_BASE}/status`; // The "check" URL

        // --- DOM Elements ---
        const statusLight = document.getElementById('status-light');
        const statusText = document.getElementById('status-text');
        const logContainer = document.getElementById('log-container');
        const packetForm = document.getElementById('packet-form');
        const injectStatus = document.getElementById('inject-status');

        /**
         * Checks the status of the Python API, which in turn checks the C++ API.
         * This is how we get the "ONLINE" light.
         */
        async function checkStatus() {
            try {
                const response = await fetch(STATUS_URL);
                if (response.status === 200) {
                    const data = await response.json();
                    if (data.status === "online") {
                        statusLight.classList.remove('bg-red-500', 'animate-pulse-fast');
                        statusLight.classList.add('bg-green-500');
                        statusText.textContent = "ONLINE (C++ & Python Servers Connected)";
                        statusText.classList.remove('text-red-400');
                        statusText.classList.add('text-green-400');
                    }
                } else {
                    throw new Error('API server is not responding');
                }
            } catch (error) {
                statusLight.classList.add('bg-red-500', 'animate-pulse-fast');
                statusLight.classList.remove('bg-green-500');
                statusText.textContent = "OFFLINE - C++/Python API not detected.";
                statusText.classList.add('text-red-400');
                statusText.classList.remove('text-green-400');
            }
        }

        /**
         * Fetches the live C++ log from our Python API.
         * This is how we fill the log box.
         */
        async function fetchLog() {
            try {
                const response = await fetch(LOG_URL);
                const data = await response.json();
                
                // The "undefined" error happens if 'data.log' doesn't exist.
                // Our new 'server.py' guarantees it will be a list.
                if (data && data.log) {
                    // Join all log messages with a newline
                    logContainer.textContent = data.log.join('\n');
                    // Auto-scroll to the bottom
                    logContainer.scrollTop = logContainer.scrollHeight;
                }
            } catch (error) {
                logContainer.textContent = "Error fetching log: " + error.message;
            }
        }

        /**
         * Handles the form submission to inject a new packet.
         */
        packetForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Stop the form from refreshing the page
            
            const formData = new FormData(packetForm);
            
            // We use 'application/x-www-form-urlencoded' because FastAPI
            // is expecting Form(...) data.
            const response = await fetch(INJECT_URL, {
                method: 'POST',
                body: new URLSearchParams(formData)
            });

            const result = await response.json();

            if (response.status === 200) {
                injectStatus.innerHTML = `<span class="text-green-400">Success: ${result.message}</span>`;
            } else {
                injectStatus.innerHTML = `<span class="text-red-400">Error: ${result.detail}</span>`;
            }
            
            // Fetch the log immediately after injecting
            fetchLog();
        });

        // --- Start the UI ---
        // 1. Check status immediately on load
        checkStatus();
        // 2. Fetch the log immediately on load
        fetchLog();
        
        // 3. Keep polling for status and logs every 2 seconds
        setInterval(checkStatus, 2000);
        setInterval(fetchLog, 2000);

    </script>
</body>
</html>